<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>مشغل الفيديو - FootTV</title>
    <style>
        /* CSS لضمان ملء الشاشة وتصميم أنيق */
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background-color: #000;
            font-family: 'Tajawal', sans-serif, Arial; color: white;
            display: flex; flex-direction: column; /* لترتيب الأزرار فوق المشغل */
        }
        #server-buttons {
            padding: 8px; background-color: #1a2533; display: none; /* إخفاء مبدئي */
            gap: 8px; flex-wrap: wrap; justify-content: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0;
        }
        .server-btn {
            background-color: #2c3e50; color: white; border: 1px solid #34495e;
            padding: 6px 14px; border-radius: 20px; cursor: pointer;
            font-family: 'Tajawal', sans-serif; font-size: 14px; font-weight: 700;
            transition: all 0.2s ease;
        }
        .server-btn:hover { background-color: #34495e; }
        .server-btn.active {
            background-color: #e63946; border-color: #f1faee;
        }
        #player-container {
            flex-grow: 1; /* لجعل المشغل يملأ باقي المساحة */
            width: 100%; height: 100%;
        }
        iframe {
            width: 100%; height: 100%; border: none;
        }
        .message-container {
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; height: 100%; padding: 20px; text-align: center;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet"/>
</head>
<body>
    <!-- سيتم وضع المحتوى هنا بواسطة JavaScript -->
    <div id="wrapper" style="width:100%; height:100%; display: flex; flex-direction: column;">
        <div id="server-buttons"></div>
        <div id="player-container"></div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const wrapper = document.getElementById('wrapper');
            const buttonContainer = document.getElementById('server-buttons');
            const playerContainer = document.getElementById('player-container');

            try {
                const urlParams = new URLSearchParams(window.location.search);
                // استخدام getAll للحصول على كل قيم البارامتر 'url'
                const targetUrls = urlParams.getAll('url');

                if (targetUrls.length === 0) {
                    throw new Error("لم يتم توفير أي روابط للمشغل.");
                }

                const workerUrl = "https://withered-mud-4e52.koora-live.workers.dev/";
                const iframe = document.createElement('iframe');
                iframe.allowfullscreen = true;
                playerContainer.appendChild(iframe);

                const loadStream = (url) => {
                    if (url) {
                        iframe.src = workerUrl + '?url=' + encodeURIComponent(url);
                    }
                };
                
                // إنشاء أزرار السيرفرات فقط إذا كان هناك أكثر من رابط واحد
                if (targetUrls.length > 1) {
                    buttonContainer.style.display = 'flex'; // إظهار حاوية الأزرار
                    targetUrls.forEach((url, index) => {
                        const button = document.createElement("button");
                        button.className = "server-btn";
                        button.textContent = "Server " + (index + 1);
                        
                        button.addEventListener('click', () => {
                            buttonContainer.querySelectorAll('.server-btn').forEach(btn => btn.classList.remove('active'));
                            button.classList.add('active');
                            loadStream(url);
                        });
                        
                        buttonContainer.appendChild(button);
                    });
                }
                
                // تحميل أول رابط بشكل افتراضي وتفعيل أول زر
                loadStream(targetUrls[0]);
                const firstButton = wrapper.querySelector('.server-btn');
                if(firstButton) {
                    firstButton.classList.add('active');
                }

            } catch (error) {
                wrapper.innerHTML = `
                    <div class="message-container">
                        <h3>حدث خطأ</h3>
                        <p>${error.message}</p>
                    </div>
                `;
                console.error("Player Error:", error);
            }
        });
    </script>
</body>
</html>
